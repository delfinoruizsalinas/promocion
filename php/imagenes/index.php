<?php
  include('../db.class.php');
  
  function Get_exten($data)
  {
      $pieces = explode(':', $data);
      $pieces = explode(';', $pieces[1]);
      $pieces = explode('/', $pieces[0]);
      return $pieces[1];
  }
  function Get_Img($data)
  {
      $pieces = explode(',', $data);
      return $pieces[1];
  }
  function resize_img($imgdata, $size)
  {
      $imgDecoded = base64_decode($imgdata);
      $im         = imagecreatefromstring($imgDecoded);
      $origWidth  = imagesx($im);
      $origHeight = imagesy($im);
      $new_width  = $size;
      if ($new_width > $origWidth) {
          $new_width = $origWidth;
      }
      $ratio      = $new_width / $origWidth;
      $new_height = $origHeight * $ratio;
      $imNew      = imagecreatetruecolor($new_width, $new_height);
      imagecopyresampled($imNew, $im, 0, 0, 0, 0, $new_width, $new_height, $origWidth, $origHeight);
      return imagejpeg($imNew, null, 100);
      imagedestroy($im);
      imagedestroy($imNew);
  }

  $dataxx  = 'data:image/jpeg;base64,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';
  //////////////////////////////
  if (isset($_GET['uid']) && isset($_GET['tkn'])) {
    
    $id_p = $_GET['uid'];
    $hash = $_GET['tkn'];
    $db = DataBase::connect();
    $db->setQuery("select * from promo where id_promo = ".$id_p." and estatus = ".$hash.";");


    $row = $db->loadObject();

    if ($row){
      $data = $row->imagen;

      if (!empty($data)) {
        $dataxx = $data;
      }

    }
    //////////////////////////////
    $imgdata = Get_Img($dataxx);
    $ext     = Get_exten($dataxx);
    header('Content-Type: image/' . $ext);
    if (isset($_GET['sz'])) {
        $sz = $_GET['sz'];
        resize_img($imgdata, $sz);
    } else {
        echo base64_decode($imgdata);
    }


   }else{
    echo "<pre>{Err: 'AAAAA3NCSVQICAjb4U/gAAAIcElEQVR4nO2c3XMT1xmHf+85uyt'}";
   } 
   echo "select * from promo where id_promo = ".$id_p." and estatus = ".$hash.";";
?>
